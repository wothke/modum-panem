/*
*	Copyright (C) 2017 Juergen Wothke
*/
function showInfo(){lastMove=(new Date).getTime();var a=document.getElementById("info");a.style.opacity="0.68",a.style.zIndex="10",null!==previousTimer&&clearTimeout(previousTimer),previousTimer=setTimeout(function(){a.style.zIndex="-10"},6e3)}var lastMove=(new Date).getTime(),previousTimer=null;WOO.FlightInstruments=function(a,b){this.scene=a,this.utils=b,this.instruments=this._create(),this.show()},WOO.FlightInstruments.prototype={show:function(){this.hide(),this.scene.add(this.instruments)},hide:function(){this.scene.remove(this.instruments)},updateInstruments:function(a,b,c,d){var e=(new THREE.Vector3).add(a).add(d),f=new THREE.Vector3(0,1,0);f=this.utils.getRotatedVector(f.normalize(),d);var g=Math.acos(f.z),h=Math.atan2(f.y,f.x);this.rotateHorizon(new THREE.Vector3(g,0,h));var i=this.utils.getRotatedVector(new THREE.Vector3(0,0,-1),e),j=(new THREE.Vector3).add(c).sub(a).negate(),k=j.length();this._glowPointer(k);var l=0;k>0&&(l=THREE.Math.radToDeg(i.angleTo(j))),this.rotateDegNorth(l)},rotateHorizon:function(a){this.artificialHorizon.rotation.x=THREE.Math.degToRad(30+this.horizonBaseRotation.x)+a.x,this.artificialHorizon.rotation.y=THREE.Math.degToRad(40+this.horizonBaseRotation.y)+a.y,this.artificialHorizon.rotation.z=THREE.Math.degToRad(80+this.horizonBaseRotation.z)+a.z},rotateDegNorth:function(a){this.north.rotation.x=THREE.Math.degToRad(this.horizonBaseRotation.x),this.north.rotation.y=THREE.Math.degToRad(this.horizonBaseRotation.y),this.north.rotation.z=THREE.Math.degToRad(this.horizonBaseRotation.z+a)},updateThrustLevel:function(a){this.thrust.scale.x=this.thrust.scale.z=this.thrust.baseScale,this.thrust.scale.y=this.thrust.baseScale/10*Math.abs(a);var b=this.thrust.scale.y*this.thrust.originalHeight/2;this.thrust.position.y=a<0?-b:b,this.thrust.rotation.z=THREE.Math.degToRad(this.thrust.baseRotation.z),a<0&&(this.thrust.rotation.z+=THREE.Math.degToRad(180)),this.thrust.position.x=this.thrust.basePos.x,this.thrust.material.color=a<0?new THREE.Color(7368816):new THREE.Color(14737632),this.thrust.needsUpdate=!0},_glowPointer:function(a){var b=5987922,c=160*(1-Math.min(1,a/.5))<<16;this.pointerMaterial.emissive=new THREE.Color(b+c)},_createHorizon:function(){for(var a=new THREE.SphereGeometry(.09,15,15,0,2*Math.PI,0,2*Math.PI),b=0;b<a.faces.length;b++)for(var c=a.faces[b],d=a.faceVertexUvs[0][b],e=0;e<d.length;e++)d[e].x=.5*c.vertexNormals[e].x+.5,d[e].y=.5*c.vertexNormals[e].y+.5;a.uvsNeedUpdate=!0;var f=new THREE.MeshPhongMaterial({name:"horizon",emissive:4210752,color:16777215,specular:2105376,shininess:0,map:this._getHorizonTexture(16),overdraw:.5,opacity:.9,transparent:!0});return new THREE.Mesh(a,f)},_getHorizonTexture:function(a){var b=document.createElement("canvas");b.width=b.height=a;var c=b.getContext("2d"),d=c.createImageData(1,1),e=d.data;e[0]=136,e[1]=164,e[2]=177,e[3]=255;for(var f=0;f<a/2;f++)for(var g=0;g<a;g++)c.putImageData(d,g,f);e[0]=255,e[1]=255,e[2]=255;for(var f=a/2;f<a;f++)for(var g=0;g<a;g++)c.putImageData(d,g,f);var h=new THREE.Texture(b);return h.name="artificial horizon",h.format=THREE.RGBAFormat,h.type=THREE.FloatType,h.generateMipmaps=!0,h.wrapS=h.wrapT=THREE.RepeatWrapping,h.minFilter=THREE.LinearMipMapLinearFilter,h.magFilter=THREE.LinearFilter,h.repeat.set(1,4),h.needsUpdate=!0,h},_createNorthIndicator:function(){var a=new THREE.Group,b=new THREE.Geometry,c=3.1;b.vertices=[new THREE.Vector3(-.5,0+c,-.5),new THREE.Vector3(.5,0+c,-.5),new THREE.Vector3(.5,0+c,.5),new THREE.Vector3(-.5,0+c,.5),new THREE.Vector3(0,1+c,0)],b.faces=[new THREE.Face3(0,1,2),new THREE.Face3(0,2,3),new THREE.Face3(1,0,4),new THREE.Face3(2,1,4),new THREE.Face3(3,2,4),new THREE.Face3(0,3,4)],b.computeFaceNormals(),this.pointerMaterial=new THREE.MeshPhongMaterial({name:"pointer",side:THREE.DoubleSide,emissive:10206930,specular:2105376,shininess:.4,overdraw:.5});var d=new THREE.Mesh(b,this.pointerMaterial);d.scale.x=d.scale.y=d.scale.z=.03,a.add(d);var e=new THREE.MeshPhongMaterial({name:"ring",side:THREE.DoubleSide,color:11386841,specular:15724527,overdraw:.5,opacity:.4,transparent:!0}),f=16,g=new THREE.TorusGeometry(2.3,.3,20,18,25),h=new THREE.Mesh(g,e);return h.scale.x=h.scale.y=h.scale.z=.05,h.rotation.z=THREE.Math.degToRad(90+f/2),a.add(h),a},_createThrustIndicator:function(){var a=25,b=8,c=new THREE.CylinderGeometry(b/2,b/2,a),d=new THREE.MeshPhongMaterial({name:"thrust",emissive:1052688,color:0,specular:2105376,shininess:40,overdraw:.5,opacity:.8,transparent:!0}),e=new THREE.Mesh(c,d);return e.originalHeight=a,e.originalWidth=b,e.baseScale=.0045,e.basePos=new THREE.Vector3(.25,0,0),e.baseRotation=new THREE.Vector3(0,0,14),e},_create:function(){var a=new THREE.Group;return this.horizonBaseRotation=new THREE.Vector3(245,-10,0),this.artificialHorizon=this._createHorizon(),this.rotateHorizon(new THREE.Vector3(0,0,0)),a.add(this.artificialHorizon),this.north=this._createNorthIndicator(),this.rotateDegNorth(0),a.add(this.north),this.thrust=this._createThrustIndicator(),this.updateThrustLevel(1),a.add(this.thrust),a.position.x=1.3,a.position.y=4.1,a.position.z=15.6,a}},WOO.BannerText=function(a){this.scene=a,this.startPos=this.previousPos=null,this.phaseRight=!0,this.textGeo=null,this.txtGroup=this._createBanner(),this.scene.add(this.txtGroup)},WOO.BannerText.prototype={isReady:function(){return this.txtGroup.children.length>0},show:function(){this.hide(),this.scene.add(this.txtGroup)},hide:function(){this.scene.remove(this.txtGroup)},_createBanner:function(){var a=new THREE.Group;a.scale.x=a.scale.y=a.scale.z=.004,a.rotation.x=0,a.rotation.y=-Math.PI/180*10,a.rotation.z=0;var b=new THREE.MeshPhongMaterial({name:"text front material",emissive:0,color:16777215,specular:8396832,shininess:30});return getMeshTexter("./One-Eighty(-)_Regular.json",function(c){this.textGeo=c.create("modum panem");var d=b,e=new THREE.MultiMaterial([null!=d?d:new THREE.MeshPhongMaterial({color:16777215,shading:THREE.FlatShading}),new THREE.MeshPhongMaterial({color:16777215,shading:THREE.SmoothShading})]),f=0,g=-.5*(this.textGeo.boundingBox.max.x-this.textGeo.boundingBox.min.x),h=new THREE.Mesh(this.textGeo,e);h.position.x=g,h.position.y=f,h.position.z=0,h.rotation.x=0,h.rotation.y=2*Math.PI,a.add(h)}.bind(this)),a},updateTextGeometry:function(a){for(var b=new THREE.Vector3,c=this.textGeo.originalBoundingBox.x,d=0,e=this.textGeo.originalVertices.length;d<e;d++){var f=this.textGeo.originalVertices[d],g=new THREE.Matrix4;g.multiply((new THREE.Matrix4).makeRotationX(THREE.Math.degToRad(30*f.x/c*Math.sin(a/95)))),b.set(f.x,f.y,f.z),b.applyMatrix4(g),this.textGeo.vertices[d].set(b.x,b.y,b.z)}this.textGeo.computeFaceNormals(),this.textGeo.computeVertexNormals(),this.textGeo.normalsNeedUpdate=!0,this.textGeo.verticesNeedUpdate=!0},animateText:function(a,b){a>0&&(null==this.startPos&&(this.startPos=[b.y,b.z]),null!=this.textGeo&&(this.updateTextPosition(b),a>3e4&&this.updateTextGeometry(a)))},updateTextPosition:function(a){var b=-1.4,c=5.4,d=13.66;if(null!=this.startPos){var e=a,f=e.y-this.startPos[0],g=e.z-this.startPos[1],h=Math.sqrt(g*g+f*f);if(null!=this.previousPos){var i=this.previousPos[0]*f+this.previousPos[1]*g,j=Math.sqrt(this.previousPos[0]*this.previousPos[0]+this.previousPos[1]*this.previousPos[1]),k=Math.sqrt(f*f+g*g);Math.acos(i/(j*k))>Math.PI/2&&(this.phaseRight=!this.phaseRight)}if(this.phaseRight){var m,l=[0,.11883898335569883,.3157312840105159,.44];for(m=0;m<l.length-1&&!(h>l[m]&&h<=l[m+1]);m++);switch(m){case 0:break;case 1:d=1e3;break;case 2:c=6,d=13;var n=13.4,o=(h-l[2])/(l[3]-l[2]);d+=(n-d)*o;var p=1,o=(h-l[2])/(l[3]-l[2]);b+=(p-b)*o}}else{var m,q=[0,.3992501616060665,.44];for(m=0;m<q.length-1&&!(h>q[m]&&h<=q[m+1]);m++);switch(m){case 0:var p=1,o=(h-q[0])/(q[1]-q[0]);b+=(p-b)*o;break;case 1:d=1e3}}}this.txtGroup.position.x=b,this.txtGroup.position.y=c,this.txtGroup.position.z=d,this.previousPos=[f,g]}},WOO.Spaceship=function(a,b){this.utils=b,this.scene=a,this.lastTime=0,this.steepBank=new THREE.Vector2,this.falconMesh=null,this.falconTexture=null,this.sphereMesh=null,this.sphereMaterial=null,this.plasmaPass=new WOO.PlasmaPass,this.plasmaPass.uniforms.tNoise.value=this.utils.getNoiseTexture(256),this.plasmaPass.uniforms.size.value=new THREE.Vector2(30,30),this.plasmaPass.plasmaTarget=this.utils.createPlasmaRenderTarget(356,316);var c=new THREE.TextureLoader;c.load("pattern2.gif",function(a){a.wrapS=a.wrapT=THREE.ClampToEdgeWrapping,a.offset.set(.5,.5),a.name="falcon texture",this.falconTexture=a,this._createMeshes()}.bind(this))},WOO.Spaceship.prototype={getBaseFlightOrientation:function(){return new THREE.Vector3(THREE.Math.degToRad(-17.47),THREE.Math.degToRad(119.42),THREE.Math.degToRad(-17.43))},animateFlightOrientation:function(a){var b=a-this.lastTime;if(b>50){var c=new THREE.Vector2(THREE.Math.degToRad(50),THREE.Math.degToRad(50));this.lastTime=a;var d=.8;this.steepBank.multiplyScalar(d);var e=(new THREE.Vector3).add(this.getBaseFlightOrientation());e.z+=c.y*Math.sin(this.steepBank.y*Math.PI/2),e.x+=c.x*Math.sin(this.steepBank.x*Math.PI/2)/2,e.y-=c.x*Math.sin(this.steepBank.x*Math.PI/2),e.x+=Math.sin(a/1e3)/20,e.y+=Math.sin(a/1e3+Math.PI/4)/20,this.setRotation(e)}},handleSteepBank:function(a,b){var c=.01;this.steepBank.x=Math.max(-1,Math.min(1,this.steepBank.x+a*c)),this.steepBank.y=Math.max(-1,Math.min(1,this.steepBank.y+b*c))},isReady:function(){return null!=this.falconMesh},update:function(a,b,c,d){null!=this.plasmaPass&&("tOffset"in window||(window.tOffset=b),this.plasmaPass.uniforms.tDetector.value=c,this.plasmaPass.uniforms.time.value=(b-window.tOffset)/1e3,d?this.plasmaPass.render(a):this.plasmaPass.render(a,this.plasmaPass.plasmaTarget))},animate:function(){var a=Math.PI/360;this.isReady()&&this.setRotation(new THREE.Vector3(2*-a,-a,3*-a).add(this.getRotation()))},_createMeshes:function(){this._loadFalconMesh(function(a){this.falconMesh=a,this.falconMesh.position.y=5.4,this.falconMesh.position.z=15.4,this.scene.add(a);for(var b=new THREE.SphereGeometry(.43,40,40,0,2*Math.PI,0,2*Math.PI),c=0;c<b.faces.length;c++)for(var d=b.faces[c],e=b.faceVertexUvs[0][c],f=0;f<e.length;f++)e[f].x=.5*d.vertexNormals[f].x+.5,e[f].y=.5*d.vertexNormals[f].y+.5;b.uvsNeedUpdate=!0,this.sphereMaterial=new THREE.MeshPhongMaterial({map:this.plasmaPass.plasmaTarget.texture,side:THREE.DoubleSide,transparent:!0,opacity:1,shading:THREE.SmoothShading,shininess:10,specular:10461183,wireframe:!1}),this.sphereMesh=new THREE.Mesh(b,this.sphereMaterial),this.sphereMesh.position.x=this.falconMesh.position.x,this.sphereMesh.position.y=this.falconMesh.position.y,this.sphereMesh.position.z=this.falconMesh.position.z,this.scene.add(this.sphereMesh)}.bind(this))},setRotation:function(a){var b=this.falconMesh.rotation;b.x=a.x,b.y=a.y,b.z=a.z,this.sphereMesh.rotation.x=b.x,this.sphereMesh.rotation.y=b.y,this.sphereMesh.rotation.z=b.z+Math.PI/2},getRotation:function(){var a=this.falconMesh.rotation;return new THREE.Vector3(a.x,a.y,a.z)},_loadFalconMesh:function(a){var b=new THREE.MeshPhongMaterial({side:THREE.DoubleSide,name:"satellite dish",wireframe:!1,shininess:55,color:8421504,specular:8421504,emissive:0}),c=new THREE.MeshPhongMaterial({side:THREE.DoubleSide,name:"cockpit window",wireframe:!1,shininess:55,color:8421504,specular:8421504,emissive:0}),d=new THREE.MeshPhongMaterial({name:"main body",side:THREE.DoubleSide,emissive:0,color:16777215,specular:2105376,shininess:0,bumpMap:this.falconTexture,map:this.falconTexture,overdraw:.5}),e=new THREE.ShaderMaterial({name:"1st pass glow shading",uniforms:WOO.AttachmentShader.getUniforms(255,.3,1),vertexShader:WOO.AttachmentShader.vertexShader,fragmentShader:WOO.AttachmentShader.fragmentShader});this.utils.loadMesh([{f:"./f1.bin",m:d},{f:"./f2.bin"},{f:"./f3.bin"},{f:"./f4.bin",m:[b,c]},{f:"./f5.bin",m:e}],.05,a)}},WOO.MandelSceneHolder=function(a){this.scene=new THREE.Scene,this.mesh=null,this.mandelboxMaterial=null,this.initialCameraPos=new THREE.Vector3(-.07963,.099261,-1.3678434),this.initialCameraOrientation=new THREE.Vector3(5.5,118.5,40),this.resetCamera(),this.noise=.9,this.bubbleOrigin=new THREE.Vector2(.5,.7),this.bubbleRadius=.2,this.condenser=new WOO.Condenser,this.resetScene(a)},WOO.MandelSceneHolder.prototype={isReady:function(){return null!=this.mandelboxMaterial},resetCameraOrientation:function(){this.setCameraOrientationDeg(this.initialCameraOrientation)},resetCamera:function(){this.setCameraPos(this.initialCameraPos),this.setCameraOrientationDeg(this.initialCameraOrientation)},getMandelPass:function(){var a=new THREE.Camera;return a.position.z=1,new THREE.RenderPass(this.scene,a)},resetScene:function(a){null!==this.mesh&&this.scene.remove(this.mesh);var b=new THREE.Vector3(.7882352941176471,1,1);this.mandelboxMaterial=getMandelboxMaterial(a.texSize.x,a.texSize.y,b,this.getCameraPos(),this.getCameraOrientationDeg(),this.bubbleOrigin,this.bubbleRadius);var c=new THREE.CubeGeometry(a.texSize.x,a.texSize.y,0);this.mesh=new THREE.Mesh(c,this.mandelboxMaterial),this.scene.add(this.mesh)},setCameraOrientationDeg:function(a){this.cameraOrientation=(new THREE.Vector3).add(a),null!=this.mandelboxMaterial&&(this.mandelboxMaterial.uniforms.cameraPitch.value=this.cameraOrientation.x,this.mandelboxMaterial.uniforms.cameraYaw.value=this.cameraOrientation.y,this.mandelboxMaterial.uniforms.cameraRoll.value=this.cameraOrientation.z)},getCameraOrientationDeg:function(){return(new THREE.Vector3).add(this.cameraOrientation)},getInitCameraOrientationDeg:function(){return(new THREE.Vector3).add(this.initialCameraOrientation)},getCameraPos:function(){return(new THREE.Vector3).add(this.cameraPos)},getInitCameraPos:function(){return(new THREE.Vector3).add(this.initialCameraPos)},setFocalLength:function(a){this.mandelboxMaterial.uniforms.cameraFocalLength.value=a},setCameraPos:function(a){this.cameraPos=(new THREE.Vector3).add(a),null!=this.mandelboxMaterial&&(this.mandelboxMaterial.uniforms.cameraPosition.value=(new THREE.Vector3).add(this.cameraPos))},getCollisionDetectionTexture:function(){return this.condenser.getResultTexture()},resetEffects:function(){this.mandelboxMaterial.uniforms.waterworld.value=0,this.mandelboxMaterial.uniforms.boxScale.value=.5,this.mandelboxMaterial.uniforms.deFactor.value=1},animate:function(a,b,c){this.noise=.995*this.noise,this.mandelboxMaterial.uniforms.deFactor.value=1-this.noise;var e,d=Math.sin(1e-5*b);e=a?new THREE.Vector3(this.cameraPos.x-.1,this.cameraPos.y+.21345,this.cameraPos.z+.011):this._getAnimationCameraPos(b,d),this.mandelboxMaterial.uniforms.waterworld.value=this._getAnimationWaterEffect(b),this.setCameraPos(e),null!=c&&(this.mandelboxMaterial.uniforms.boxScale.value=this._getAnimationBoxZoom(c,d))},postprocess:function(a,b){this.condenser.runChain(a,this.bubbleOrigin,this.bubbleRadius,b)},_getAnimationCameraPos:function(a,b){var c=new THREE.Vector3(this.initialCameraPos.x,this.initialCameraPos.y,this.initialCameraPos.z);return c.y=c.y+.02*Math.sin(4e-5*a),c.z=c.z-.44*b,c},_getAnimationWaterEffect:function(a){var b=Math.sin(4e-5*(a-15e3));return b>0?.02*b:0},_getAnimationBoxZoom:function(a,b){b=Math.abs(b);var c=b<.5?1-20*b:0;c=1+249*c;var d=(a[39]+a[199]+a[299])/(1e6/c);return d+.5}};var defaultWidth=640,defaultHeight=480;WOO.DemoMode={ANIMATION:0,LOOKAROUND:1,FREEFLIGHT:2},Woofer=function(a){this.mode=WOO.DemoMode.ANIMATION,this.canvasId=a,this.canvas=null,this.timeOffset=0,this.filmPass=new THREE.FilmPass(0,1.4,500,!1),this.intensity=0,this.beatDetector=new WOO.SoundDetector(115,1,!1,50,32,1,13),this.mandelSceneHolder=this.renderer=this.composer=this.target=this.flightInstruments=this.spaceship=this.bannerText=null,this.movementSpeed=0,this.rndOffset=new THREE.Vector3,this.utils=new WOO.Utils},Woofer.prototype={getSpaceshipPass:function(a,b){this.spaceshipScene=new THREE.Scene;var c=new THREE.AmbientLight(3092271);this.spaceshipScene.add(c);var d=new THREE.DirectionalLight(4210752,1.4);d.position=new THREE.Vector3(0,-1,0),this.spaceshipScene.add(d);var e=new THREE.PerspectiveCamera(70,a/b,1,3e3);return e.position.set(0,5.5,17),e.lookAt(this.spaceshipScene.position),this.flightInstruments=new WOO.FlightInstruments(this.spaceshipScene,this.utils),this.flightInstruments.hide(),this.spaceship=new WOO.Spaceship(this.spaceshipScene,this.utils),this.bannerText=new WOO.BannerText(this.spaceshipScene),new THREE.RenderPass(this.spaceshipScene,e)},swapTarget:function(a){return a.needsSwap=!0,a.renderToScreen=!1,a.clear=!1,a.clearDepth=!1,a},sameTarget:function(a){return a.renderToScreen=!1,a.needsSwap=!1,a.clearDepth=!1,a.clear=!1,a},getEffectComposer:function(a){var b=new WOO.MultiTargetEffectComposer(this.renderer,a),c=this.mandelSceneHolder.getMandelPass();c.renderToScreen=!1,c.needsSwap=!1,b.addPass(c);var d=this.sameTarget(this.getSpaceshipPass(a.texSize.x,a.texSize.y));b.addPass(d);var e=this.swapTarget(new WOO.ExhaustGlowPass);b.addPass(e);var f=this.swapTarget(new WOO.RaysPass(new THREE.Vector2(.7,.7),.012,.9,.99,1));return b.addPass(f),this.filmPass.renderToScreen=!0,b.addPass(this.filmPass),b},getCameraVector:function(){var a=this.mandelSceneHolder.getCameraOrientationDeg();return this.utils.getRotatedVector(new THREE.Vector3(0,0,-1).normalize(),a)},moveShip:function(a){a=Math.sign(a)*(1-Math.cos(Math.PI/2*a/10));var b=.001*a,c=this.getCameraVector();c.multiplyScalar(b);var d=this.mandelSceneHolder.getCameraPos(),e=(new THREE.Vector3).add(d).add(c),f=1e-7,g=Math.random()*f-f/2,h=Math.random()*f-f/2,i=Math.random()*f-f/2;this.rndOffset=new THREE.Vector3((3*this.rndOffset.x+g)/4,(3*this.rndOffset.y+h)/4,(3*this.rndOffset.z+i)/4),e.add(this.rndOffset),this.mandelSceneHolder.setCameraPos(e)},rotateShip:function(a){this.mode!=WOO.DemoMode.ANIMATION&&this.spaceship.setRotation(a.add(this.spaceship.getRotation()))},drag:function(a,b,c,d,e){if(this.mode!=WOO.DemoMode.ANIMATION){c*=15,d*=15;var f=this.mandelSceneHolder.getCameraOrientationDeg(),g=new THREE.Matrix4;g.makeRotationFromEuler(new THREE.Euler(THREE.Math.degToRad(-d),THREE.Math.degToRad(0),THREE.Math.degToRad(0),"ZYX"));var h=new THREE.Matrix4;h.makeRotationFromEuler(new THREE.Euler(THREE.Math.degToRad(f.x),THREE.Math.degToRad(f.y),THREE.Math.degToRad(f.z),"ZYX"));var i=new THREE.Euler,j=g.multiply(h);i.setFromRotationMatrix(j,"ZYX");var k=new THREE.Vector3(THREE.Math.radToDeg(i.x),THREE.Math.radToDeg(i.y),THREE.Math.radToDeg(i.z)-c);this.spaceship.handleSteepBank(c,d),this.mandelSceneHolder.setCameraOrientationDeg(k)}},changeSpeed:function(a){var b=this.changeMovementSpeed(a);this.flightInstruments.updateThrustLevel(b)},changeMovementSpeed:function(a){return this.movementSpeed=Math.min(10,Math.max(-10,this.movementSpeed+a)),this.movementSpeed},start:function(){return null==window.location.hash||""==window.location.hash?window.music=new WOO.MP3Music("Drumhead - Symbol.mp3"):window.music=new WOO.SoundCloudMusic,this.canvas=$("#"+this.canvasId)[0],this.renderer=new THREE.WebGLRenderer({canvas:this.canvas,alpha:!0,preserveDrawingBuffer:!0,autoClearDepth:!1}),this.renderer.autoClear=!1,this.renderer.extensions.get("EXT_frag_depth")?this.renderer.extensions.get("WEBGL_draw_buffers")?(this.target=getRenderTarget(defaultWidth,defaultHeight),this.mandelSceneHolder=new WOO.MandelSceneHolder(this.target),this.composer=this.getEffectComposer(this.target),this.resize(!0),this.startUserInputHander(),void this.render(0)):void alert("error: WEBGL_draw_buffers not available"):void alert("error: EXT_frag_depth not available")},startUserInputHander:function(){new WOO.Controls({preventDefault:function(){return this.mode!=WOO.DemoMode.ANIMATION}.bind(this),keyDown:function(a,b){switch(a){case 38:this.drag(0,0,0,-.1,!1);break;case 40:this.drag(0,0,0,.1,!1);break;case 39:this.drag(0,0,.1,0,!1);break;case 37:this.drag(0,0,-.1,0,!1);break;case 13:showInfo();break;case 32:this.mode=this.mode==WOO.DemoMode.ANIMATION||this.mode==WOO.DemoMode.LOOKAROUND?WOO.DemoMode.FREEFLIGHT:WOO.DemoMode.ANIMATION,this.mode==WOO.DemoMode.ANIMATION?(this.flightInstruments.hide(),this.bannerText.show(),this.mandelSceneHolder.resetCamera(),this.mandelSceneHolder.setFocalLength(.9),this.timeOffset=0):(this.spaceship.setRotation(this.spaceship.getBaseFlightOrientation()),this.flightInstruments.show(),this.bannerText.hide(),this.mandelSceneHolder.setFocalLength(2),this.filmPass.uniforms.nIntensity.value=0,this.mandelSceneHolder.resetEffects());break;case 17:this.mode==WOO.DemoMode.ANIMATION?(this.mode=WOO.DemoMode.LOOKAROUND,this.flightInstruments.show(),this.bannerText.hide()):this.mode==WOO.DemoMode.LOOKAROUND&&(this.mode=WOO.DemoMode.ANIMATION,this.mandelSceneHolder.resetCameraOrientation(),this.flightInstruments.hide(),this.bannerText.show())}}.bind(this),keyPress:function(a,b){var c=THREE.Math.degToRad(1);switch(b){case"y":this.rotateShip(new THREE.Vector3(c,0,0));break;case"Y":this.rotateShip(new THREE.Vector3(-c,0,0));break;case"x":this.rotateShip(new THREE.Vector3(0,c,0));break;case"X":this.rotateShip(new THREE.Vector3(0,-c,0));break;case"c":this.rotateShip(new THREE.Vector3(0,0,c));break;case"C":this.rotateShip(new THREE.Vector3(0,0,-c))}switch(a){case 113:this.changeSpeed(1);break;case 97:this.changeSpeed(-1);break;case 112:var d=this.mandelSceneHolder.getCameraPos();console.log("mandelbox coord: "+d.x+" / "+d.y+" / "+d.z)}}.bind(this),rotation:function(a,b,c,d,e){this.drag(a,b,c,d,e),this.mode==WOO.DemoMode.ANIMATION&&showInfo()}.bind(this),mouseWheel:function(a){this.changeSpeed(a)}.bind(this)},this.canvasId,this.fullscreenToggle.bind(this))},stfu:function(a){var b=console.warn;console.warn=function(){},a.bind(this)(),console.warn=b},isReady:function(){return this.spaceship.isReady()&&this.bannerText.isReady()},isMusicPlaying:function(a){return!music.isPaused()&&null!==a},animateSoundEffect:function(a){this.intensity=.94*this.intensity,this.beatDetector.detect(a)&&(this.intensity=.6),this.filmPass.uniforms.nIntensity.value=this.intensity},updateFlightInstruments:function(){var a=this.mandelSceneHolder.getInitCameraPos(),b=this.mandelSceneHolder.getInitCameraOrientationDeg(),c=this.mandelSceneHolder.getCameraPos(),d=this.mandelSceneHolder.getCameraOrientationDeg();this.flightInstruments.updateInstruments(a,b,c,d)},render:function(a){var b=!1;if(this.isReady()){var c=music.getFrequencyData();if(this.mode==WOO.DemoMode.FREEFLIGHT)this.moveShip(this.movementSpeed),this.spaceship.animateFlightOrientation(a),this.updateFlightInstruments(),this.animateSoundEffect(c);else{this.spaceship.animate(),this.mode==WOO.DemoMode.LOOKAROUND&&this.updateFlightInstruments(),this.isMusicPlaying(c)||this.mandelSceneHolder.animate(b,0);var d=0==this.timeOffset?0:a-this.timeOffset,e=this.mandelSceneHolder.getCameraPos();this.mode==WOO.DemoMode.ANIMATION&&this.bannerText.animateText(d,e),this.isMusicPlaying(c)&&(0==this.timeOffset&&(this.timeOffset=a),d=a-this.timeOffset,this.mandelSceneHolder.animate(b,d,c),this.animateSoundEffect(c))}this.stfu(function(){var b=!1;this.spaceship.isReady()&&this.spaceship.update(this.renderer,a,this.mandelSceneHolder.getCollisionDetectionTexture(),b),b||this.composer.render()}),this.mandelSceneHolder.postprocess(this.renderer,this.composer.readBuffer.attachments[1])}requestAnimationFrame(this.render.bind(this))},resize:function(a){var b=this.renderer.domElement,c=1,d=b.clientWidth*c,e=b.clientHeight*c;if(a||d!=b.width||e!=b.height){var f=!1;this.renderer.setSize(d,e,f)}},fullscreenToggle:function(a){var c,d,b=this.renderer.domElement;a?(c=window.screen.availWidth,d=window.screen.availHeight):(c=defaultWidth,d=defaultHeight),b.clientWidth=c,b.clientHeight=d;var e=$("#"+this.canvasId)[0];e.width=c,e.height=d,e.style.width=c+"px",e.style.height=d+"px",this.resize(!0),this.target=getRenderTarget(c,d),this.mandelSceneHolder.resetScene(this.target),this.composer=this.getEffectComposer(this.target)}};