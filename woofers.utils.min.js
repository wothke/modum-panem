/*
*	Copyright (C) 2017 Juergen Wothke
*/
function getMeshTexter(a,b){var c=new THREE.FontLoader;c.load(a,function(a){this.font=a;var c=new WOO.MeshText(a);b(c)})}WOO="WOO"in window?WOO:{},"$"in window||($=function(a){var b=document.getElementById(a.replace("#","")),c=b.tagName.toUpperCase();return"CANVAS"==c||"AUDIO"==c?b=[b]:(b.empty=function(){return b.innerHTML="",b},b.append=function(a){return b.insertAdjacentHTML("beforeend",a),b},b.html=function(a){b.innerHTML=a}),b},$.getJSON=function(a,b){this.fail=function(){};var c=new XMLHttpRequest;return c.onreadystatechange=function(){c.readyState===XMLHttpRequest.DONE&&(200===c.status?b&&b(JSON.parse(c.responseText)):this.fail())},c.open("GET",a,!0),c.send(),{fail:function(a){this.fail=a}.bind(this)}}),WOO.MeshText=function(a){this.height=4,this.size=70,this.curveSegments=4,this.bevelThickness=3,this.bevelSize=4.5,this.bevelEnabled=!0,this.font=a},WOO.MeshText.prototype={create:function(a){var b=new THREE.TextGeometry(a,{font:font,size:this.size,height:this.height,curveSegments:this.curveSegments,bevelThickness:this.bevelThickness,bevelSize:this.bevelSize,bevelEnabled:this.bevelEnabled,material:0,extrudeMaterial:1});if(b.computeBoundingBox(),b.computeVertexNormals(),!this.bevelEnabled)for(var c=.1*(this.height*this.size),d=0;d<b.faces.length;d++){var e=b.faces[d];if(1==e.materialIndex){for(var f=0;f<e.vertexNormals.length;f++)e.vertexNormals[f].z=0,e.vertexNormals[f].normalize();var g=b.vertices[e.a],h=b.vertices[e.b],i=b.vertices[e.c],j=THREE.GeometryUtils.triangleArea(g,h,i);if(j>c)for(var f=0;f<e.vertexNormals.length;f++)e.vertexNormals[f].copy(e.normal)}}b.originalVertices=[];for(var f=0;f<b.vertices.length;f++){var k=new THREE.Vector3;k.set(b.vertices[f].x,b.vertices[f].y,b.vertices[f].z),b.originalVertices[f]=k}return b.originalBoundingBox=new THREE.Vector3(b.boundingBox.max.x-b.boundingBox.min.x,b.boundingBox.max.y-b.boundingBox.min.y,b.boundingBox.max.z-b.boundingBox.min.z),b}},WOO.FullscreenSwitcher=function(a,b){var c=this;this.elementId=a,this.fullscreenToggleCallback=b,document.addEventListener("fullscreenchange",function(){c.fullscreenToggleCallback(!!document.fullscreen)},!1),document.addEventListener("mozfullscreenchange",function(){c.fullscreenToggleCallback(!!document.mozFullScreen)},!1),document.addEventListener("webkitfullscreenchange",function(){c.fullscreenToggleCallback(!!document.webkitIsFullScreen)},!1),document.onkeydown=function(a){if(122==a.keyCode)return this.toggleFullScreen(),a.keyCode=0,!1}.bind(this)},WOO.FullscreenSwitcher.prototype={toggleFullScreen:function(){if(document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement)document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen();else{var a=document.getElementById(this.elementId);a.requestFullscreen?a.requestFullscreen():a.msRequestFullscreen?a.msRequestFullscreen():a.mozRequestFullScreen?a.mozRequestFullScreen():a.webkitRequestFullscreen&&a.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT)}}},WOO.Controls=function(a,b,c,d){this.observer=a,this.test=["ok"],this.absMode=d,this.reset(),null!=b&&new WOO.FullscreenSwitcher(b,c),document.addEventListener("mousedown",this.onDocumentMouseDown.bind(this),!1),document.addEventListener("touchstart",this.onDocumentTouchStart.bind(this),!1),document.addEventListener("touchmove",this.onDocumentTouchMove.bind(this),!1),document.addEventListener("keypress",this.onDocumentKeyPress.bind(this),!1),document.addEventListener("keydown",this.onDocumentKeyDown.bind(this),!1),document.addEventListener("mousewheel",this.onDocumentMouseWheel.bind(this),!1),document.addEventListener("DOMMouseScroll",this.onDocumentMouseWheel.bind(this),!1)},WOO.Controls.prototype={reset:function(){this.targetRotationX=0,this.targetRotationXOnMouseDown=0,this.targetRotationY=0,this.targetRotationYOnMouseDown=0,this.mouseX=0,this.mouseXOnMouseDown=0,this.mouseY=0,this.mouseYOnMouseDown=0,this.windowHalfX=window.innerWidth/2,this.windowHalfY=window.innerHeight/2},onDocumentMouseWheel:function(a){this.observer.preventDefault()&&a.preventDefault();var a=window.event||a,b=Math.max(-1,Math.min(1,a.wheelDelta||-a.detail));return this.observer.mouseWheel(b),!1},onDocumentMouseDown:function(a){this.observer.preventDefault()&&a.preventDefault(),this.mmove=this.onDocumentMouseMove.bind(this),this.mup=this.onDocumentMouseUp.bind(this),this.mout=this.onDocumentMouseOut.bind(this),document.addEventListener("mousemove",this.mmove,!1),document.addEventListener("mouseup",this.mup,!1),document.addEventListener("mouseout",this.mout,!1),this.mouseXOnMouseDown=a.clientX-this.windowHalfX,this.targetRotationXOnMouseDown=this.absMode?0:this.targetRotationX,this.mouseYOnMouseDown=a.clientY-this.windowHalfY,this.targetRotationYOnMouseDown=this.absMode?0:this.targetRotationY},onDocumentMouseMove:function(a){this.mouseX=a.clientX-this.windowHalfX;var b=this.targetRotationX;this.targetRotationX=this.targetRotationXOnMouseDown+.02*(this.mouseX-this.mouseXOnMouseDown),this.mouseY=a.clientY-this.windowHalfY;var c=this.targetRotationY;this.targetRotationY=this.targetRotationYOnMouseDown+.02*(this.mouseY-this.mouseYOnMouseDown),this.observer.rotation(this.targetRotationX,this.targetRotationY,this.targetRotationX-b,this.targetRotationY-c,!1)},onDocumentMouseUp:function(a){document.removeEventListener("mousemove",this.mmove,!1),document.removeEventListener("mouseup",this.mup,!1),document.removeEventListener("mouseout",this.mout,!1),this.observer.rotation(this.targetRotationX,this.targetRotationY,0,0,!0)},onDocumentMouseOut:function(a){document.removeEventListener("mousemove",this.mmove,!1),document.removeEventListener("mouseup",this.mup,!1),document.removeEventListener("mouseout",this.mout,!1),this.observer.rotation(this.targetRotationX,this.targetRotationY,0,0,!0)},onDocumentTouchStart:function(a){1==a.touches.length&&(this.observer.preventDefault()&&a.preventDefault(),this.mouseXOnMouseDown=a.touches[0].pageX-this.windowHalfX,this.targetRotationXOnMouseDown=0,this.mouseYOnMouseDown=a.touches[0].pageY-this.windowHalfY,this.targetRotationYOnMouseDown=0,this.targetRotationY)},onDocumentTouchMove:function(a){if(1==a.touches.length){this.observer.preventDefault()&&a.preventDefault(),this.mouseX=a.touches[0].pageX-this.windowHalfX;var b=this.targetRotationX;this.targetRotationX=this.targetRotationXOnMouseDown+.05*(this.mouseX-this.mouseXOnMouseDown),this.mouseY=a.touches[0].pageY-this.windowHalfY;var c=this.targetRotationY;this.targetRotationY=this.targetRotationYOnMouseDown+.05*(this.mouseY-this.mouseYOnMouseDown),this.observer.rotation(this.targetRotationX,this.targetRotationY,this.targetRotationX-b,this.targetRotationY-c,!1)}},onDocumentKeyPress:function(a){var b=a.which;this.observer.keyPress(b,String.fromCharCode(b))},onDocumentKeyDown:function(a){var b=a.which;this.observer.keyDown(b,String.fromCharCode(b))}},WOO.Utils=function(){},WOO.Utils.prototype={getPackedGeometryLoader:function(a){var b=new THREE.JSONLoader;return a.endsWith(".json")||(b.load=function(a,b,c,d){var e=this,f=this.texturePath&&"string"==typeof this.texturePath?this.texturePath:THREE.Loader.prototype.extractUrlBase(a);d=function(a){console.log("error: "+a)};var g=new THREE.ImageLoader(this.manager);g.load(a,function(c){URL.revokeObjectURL(c.currentSrc);var d=document.createElement("canvas");d.width=c.width,d.height=c.height;var g=d.getContext("2d");g.drawImage(c,0,0);for(var h=g.getImageData(0,0,c.width,c.height).data,i="",j=0;j<h.length;j++)(j+1)%4>0&&(i+=String.fromCharCode(h[j]));var k=JSON.parse(i),l=k.metadata;if(void 0!==l){var m=l.type;if(void 0!==m){if("object"===m.toLowerCase())return void console.error("THREE.JSONLoader: "+a+" should be loaded with THREE.ObjectLoader instead.");if("scene"===m.toLowerCase())return void console.error("THREE.JSONLoader: "+a+" should be loaded with THREE.SceneLoader instead.")}}var n=e.parse(k,f);b(n.geometry,n.materials)},c,d)}),b},loadMesh:function(a,b,c){for(var d=null,e=[],f=a.length,g=0;g<a.length;g++){var h=a[g].f,i=this.getPackedGeometryLoader(h);i.fileId=g,i.load(h,function(g,h){var i="m"in a[this.fileId]?a[this.fileId].m:[];if("[object Array]"!==Object.prototype.toString.call(i)&&(i=[i]),i.length>0){var j=Math.min(i.length,h.length);for(m=0;m<j;m++)h[m]=i[m]}for(var k=e.length,l=0;l<h.length;l++){var n=h[l];e.push(n)}var o=[new THREE.Vector2(0,0),new THREE.Vector2(0,0),new THREE.Vector2(0,0)];if(0==g.faceVertexUvs[0].length)for(var p=0;p<g.faces.length;p++)g.faceVertexUvs[0].push(o);if(null==d)d=g;else{var q=new THREE.Mesh(d);d.merge(g,q.matrix,k)}if(f-=1,0==f){d.uvsNeedUpdate=!0,d.computeFaceNormals(),d.computeVertexNormals();var r=new THREE.Mesh(d,new THREE.MeshFaceMaterial(e));r.scale.x=r.scale.y=r.scale.z=b,c(r)}}.bind(i))}},getNoiseTexture:function(a){for(var a=256,b=4*a*a,c=new Uint8Array(b),d=0;d<b;d++)c[d]=255*Math.random();var e=new THREE.DataTexture(c,a,a,THREE.RGBAFormat,THREE.UnsignedByteType);return this._setupNoiseTexture(e)},getIqNoiseTexture:function(){for(var a=256,b=new Uint8Array(4*a*a),c=0;c<a*a;c++)b[4*c+0]=255*Math.random(),b[4*c+2]=255*Math.random();for(var d=0;d<a;d++)for(var e=0;e<a;e++){var f=256+e-37&255,g=256+d-17&255;b[4*(e+d*a)+1]=b[4*(f+g*a)+0],b[4*(e+d*a)+3]=b[4*(f+g*a)+2]}var h=new THREE.DataTexture(b,a,a,THREE.RGBAFormat,THREE.UnsignedByteType);return this._setupNoiseTexture(h)},_setupNoiseTexture:function(a){return a.format=THREE.RGBAFormat,a.type=THREE.UnsignedByteType,a.generateMipmaps=!0,a.flipY=!0,a.wrapS=a.wrapT=THREE.RepeatWrapping,a.minFilter=THREE.LinearMipMapLinearFilter,a.magFilter=THREE.LinearFilter,a.needsUpdate=!0,a},createPlasmaRenderTarget:function(a,b){var c=new THREE.WebGLRenderTarget(a,b),d=c.texture;return d.name="plasma texture",d.format=THREE.RGBAFormat,d.minFilter=THREE.LinearFilter,d.magFilter=THREE.LinearFilter,d.type=THREE.FloatType,d.generateMipmaps=!1,d.wrapS=d.wrapT=THREE.ClampToEdgeWrapping,d.repeat.set(1,1),c.stencilBuffer=!1,c.depthBuffer=!1,c},getRotatedVector:function(a,b){var c=(new THREE.Vector3).add(a).normalize();return c.applyEuler(new THREE.Euler(THREE.Math.degToRad(-b.x),THREE.Math.degToRad(-b.y),THREE.Math.degToRad(-b.z),"XYZ")),c}},WOO.SoundCloudMusic=function(){this.gainNode=null,this.analyserNode=null,this.freqByteData=0;var a={setConfig:function(a){}.bind(this),setupWebAudioNodes:function(a){if(!this.once){this.once=!0;var b=audioCtx.createMediaElementSource(a);this.analyserNode=audioCtx.createAnalyser(),b.connect(this.analyserNode),this.gainNode=audioCtx.createGain(),this.analyserNode.connect(this.gainNode),this.gainNode.connect(audioCtx.destination)}}.bind(this)};window.cloudPlayer=new CloudPlayer({player:"#player",source:"#mp3Source",loading:"#isloading",title:"#sound-title"},a,null),window.cloudPlayer.initMusic(),window.addEventListener("hashchange",function(){window.cloudPlayer.startMusic()},!1)},WOO.SoundCloudMusic.prototype={setVolume:function(a){null!=this.gainNode&&(this.gainNode.gain.value=a)},getFrequencyData:function(){if(0==this.freqByteData){if(null==this.analyserNode)return null;this.freqByteData=new Uint8Array(this.analyserNode.frequencyBinCount)}return this.analyserNode.getByteFrequencyData(this.freqByteData),this.freqByteData},isPaused:function(){return!1}},WOO.MP3Music=function(a){this.musicFileBuffer=null,this.gainNode=null,this.analyserNode=null,this.freqByteData=0;try{window.AudioContext=window.AudioContext||window.webkitAudioContext,this.context=new AudioContext}catch(a){alert("Web Audio API is not supported in this browser")}this._loadMusic(a)},WOO.MP3Music.prototype={setVolume:function(a){null!=this.gainNode&&(this.gainNode.gain.value=a)},getFrequencyData:function(){if(0===this.freqByteData){if(null==this.analyserNode)return null;this.freqByteData=new Uint8Array(this.analyserNode.frequencyBinCount)}return this.analyserNode.getByteFrequencyData(this.freqByteData),this.freqByteData},isPaused:function(){return!1},_loadMusic:function(a){var b=new XMLHttpRequest;b.open("GET",a,!0),b.responseType="arraybuffer",b.onload=function(){this.context.decodeAudioData(b.response,function(a){this.musicFileBuffer=a,this._playSound(this.musicFileBuffer)}.bind(this),function(){}.bind(this))}.bind(this),b.send()},_playSound:function(a){var b=this.context.createBufferSource();b.loop=!0,b.buffer=a,this.gainNode=this.context.createGain(),this.analyserNode=this.context.createAnalyser(),b.connect(this.gainNode),this.gainNode.connect(this.analyserNode),this.analyserNode.connect(this.context.destination),b.start(0)}},WOO.SoundDetector=function(a,b,c,d,e,f,g){this.lastDetect=0,this.repeatCount=0,this.trigger=a,this.repeats=b,this.repeatCount=0,this.invert=c,this.cooldown=d,this.stepWidth=e,this.startStep=f,this.maxSteps=g},WOO.SoundDetector.prototype=Object.assign(Object.create(WOO.SoundDetector.prototype),{constructor:WOO.SoundDetector,detect:function(a){if(null==a||0==a.length)return!1;var b=new Date,c=b.getTime();if(c-this.lastDetect<=this.cooldown)return!1;for(var d=0,e=Math.floor(a.length/this.stepWidth),f=0,g=0;f<e;f++){if(f>=this.startStep){if(this.invert){if(a[d]>this.trigger)return!1}else if(a[d]<this.trigger)return!1;if(g+=1,this.maxSteps>0&&g>=this.maxSteps)break}d+=this.stepWidth}return this.repeatCount++>=this.repeats&&(this.lastDetect=c,this.repeatCount=0,!0)}});